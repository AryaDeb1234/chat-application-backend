<!-- <!DOCTYPE html>
<html>
<head>
  <title>Socket Test</title>
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
</head>
<body>
  <h2>Socket.io Test</h2>

  <button onclick="connectUser()">Connect User</button>
  <button onclick="joinChat()">Join Chat</button>

  <script>
    const socket = io("http://localhost:5000");

    function connectUser() {
  const userId = prompt("Enter your user ID:");
  socket.emit("setup", userId);
  console.log("setup emitted for user:", userId);
}

function joinChat() {
  const chatId = prompt("Enter chat ID to join:");
  socket.emit("join chat", chatId);
  console.log("join chat emitted for chat:", chatId);
}


    socket.on("connected", () => {
      console.log("Socket connected to server");
    });

    socket.on("message received", (msg) => {
      console.log("New message:", msg);
    });
  </script>
</body>
</html> -->
<!DOCTYPE html>
<html>
<head>
  <title>Socket.io Test</title>
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
</head>
<body>
  <h2>Socket.io Chat Test</h2>

  <button onclick="connectUser()">Connect User</button>
  <button onclick="joinChat()">Join Chat</button>
  <br><br>

  <input id="messageInput" type="text" placeholder="Type a message" />
  <button onclick="sendMessage()">Send Message</button>

  <div id="typingStatus"></div>
  <div id="messages"></div>

  <script>
    const socket = io("https://chat-application-backend-nhj9.onrender.com", {
  transports: ["websocket"],
});

    let currentUserId;
    let currentChatId;

    // Connect user
    function connectUser() {
      currentUserId = prompt("Enter your user ID:");
      socket.emit("setup", currentUserId);
      console.log("setup emitted for user:", currentUserId);
    }

    // Join chat
    function joinChat() {
      currentChatId = prompt("Enter chat ID to join:");
      socket.emit("join chat", currentChatId);
      console.log("join chat emitted for chat:", currentChatId);
    }

    // Send message
    function sendMessage() {
      const content = document.getElementById("messageInput").value;
      if (!content || !currentChatId) return;
      const message = {
        sender: { _id: currentUserId },
        chat: currentChatId,
        content
      };
      socket.emit("send message", message);
      appendMessage("You: " + content);
      document.getElementById("messageInput").value = "";
      socket.emit("stop typing", currentChatId);
    }

    // Typing indicator
    const input = document.getElementById("messageInput");
    let typingTimer;
    input.addEventListener("input", () => {
      if (!currentChatId) return;
      socket.emit("typing", currentChatId);
      clearTimeout(typingTimer);
      typingTimer = setTimeout(() => {
        socket.emit("stop typing", currentChatId);
      }, 1000);
    });

    // Socket events
    socket.on("connected", () => console.log("Socket connected to server"));
    socket.on("message received", (msg) => appendMessage(msg.sender.username + ": " + msg.content));
    socket.on("typing", () => document.getElementById("typingStatus").innerText = "Someone is typing...");
    socket.on("stop typing", () => document.getElementById("typingStatus").innerText = "");
    socket.on("online users", (users) => console.log("Online users:", users));

    function appendMessage(text) {
      const div = document.createElement("div");
      div.innerText = text;
      document.getElementById("messages").appendChild(div);
    }
  </script>
</body>
</html>
